{% comment %}
  Renders accessible flavor "chips" from a provided array.
  Params:
    - flavors (Array<string>)  - required
    - title (string)           - optional
    - option_name (string)     - defaults to 'Flavor'
{% endcomment %}

{%- assign option_name = option_name | default: 'Flavor' -%}
{%- assign group_id = 'flavors-' | append: option_name | handleize -%}

<div class="wtf-flavor-group" role="radiogroup" aria-label="{{ title | default: option_name }}" id="{{ group_id }}">
  {% if title %}
    <h3 class="wtf-flavor-title">{{ title }}</h3>
  {% endif %}

  <div class="wtf-flavor-grid">
    {% for value in flavors %}
      {% assign btn_id = group_id | append: '-' | append: forloop.index %}
      <button
        id="{{ btn_id }}"
        class="wtf-flavor-chip"
        type="button"
        role="radio"
        aria-checked="false"
        data-option="{{ option_name }}"
        data-value="{{ value | strip }}"
      >
        <span class="wtf-flavor-label">{{ value }}</span>
      </button>
    {% endfor %}
  </div>
</div>

<style>
  .wtf-flavor-title { margin: 0 0 8px; font-weight: 600; font-size: 1.125rem; }
  .wtf-flavor-grid { display: grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap: 8px; }
  @media (min-width: 480px){ .wtf-flavor-grid { grid-template-columns: repeat(3, minmax(0,1fr)); } }
  @media (min-width: 768px){ .wtf-flavor-grid { grid-template-columns: repeat(4, minmax(0,1fr)); } }

  .wtf-flavor-chip {
    display: inline-flex; align-items: center; justify-content: center;
    min-height: 44px; padding: 10px 12px; width: 100%;
    border: 1.5px solid #ddd; border-radius: 999px; background: #fff; color: #333;
    font: inherit; cursor: pointer; transition: transform .06s ease, border-color .15s ease, box-shadow .15s ease;
  }
  .wtf-flavor-chip:hover { border-color: #bbb; transform: translateY(-1px); }
  .wtf-flavor-chip:focus-visible { outline: 2px solid #ff6600; outline-offset: 2px; }
  .wtf-flavor-chip.is-selected { border-color: #ff6600; box-shadow: 0 0 0 3px rgba(255,102,0,.15); }
  .wtf-flavor-label { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
</style>

<script>
  (function () {
    document.addEventListener('click', function (e) {
      var chip = e.target.closest('.wtf-flavor-chip');
      if (!chip) return;

      var group = chip.closest('.wtf-flavor-group');
      if (!group) return;

      group.querySelectorAll('.wtf-flavor-chip').forEach(function (b) {
        b.classList.remove('is-selected');
        b.setAttribute('aria-checked', 'false');
      });

      chip.classList.add('is-selected');
      chip.setAttribute('aria-checked', 'true');

      var detail = { option: chip.dataset.option, value: chip.dataset.value, groupId: group.id };
      group.dispatchEvent(new CustomEvent('wtf:optionSelected', { bubbles: true, detail: detail }));
      document.dispatchEvent(new CustomEvent('wtf:optionSelectedGlobal', { bubbles: true, detail: detail }));
    });

    document.addEventListener('keydown', function (e) {
      if ((e.key === ' ' || e.key === 'Enter') && e.target.closest('.wtf-flavor-chip')) {
        e.preventDefault();
        e.target.click();
      }
    });
  })();
</script>
